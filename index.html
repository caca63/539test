<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å°ç£ 539 æ©Ÿç‡åˆ†æå™¨ v1.0</title>
<style>
body{
  background:#0f172a;
  color:#e5e7eb;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial;
  margin:0;
  padding:16px;
}
.card{
  background:#111827cc;
  padding:14px;
  border-radius:16px;
  margin-bottom:12px;
  box-shadow:0 10px 25px rgba(15,23,42,.6);
}
.btn{
  padding:8px 12px;
  border-radius:999px;
  border:0;
  background:linear-gradient(135deg,#22d3ee,#60a5fa);
  color:#020617;
  font-weight:700;
  cursor:pointer;
}
.btn.sec{
  background:#020617;
  color:#e5e7eb;
  border:1px solid rgba(148,163,184,.25);
}
input,textarea,select{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid rgba(148,163,184,.25);
  background:#020617;
  color:#e5e7eb;
  box-sizing:border-box;
}
.row{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  align-items:center;
  margin-top:4px;
}
.divider{
  border-top:1px dashed rgba(148,163,184,.4);
  margin:2px 0;
}
.mono{
  white-space:pre-wrap;
  font-family:ui-monospace,Consolas,monospace;
}

.split2{
  display:flex;
  gap:8px;
}
.split2>div{
  flex:1;
  display:flex;
  flex-direction:column;
}

.chip{
  background:#1e293b;
  border-radius:12px;
  padding:6px 8px;
  font-size:13px;
  border:1px solid rgba(148,163,184,.35);
  box-shadow:0 4px 10px rgba(15,23,42,.8);
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:4px;
}
.chip.rankTop{
  border-color:#38bdf8;
  box-shadow:0 0 0 1px rgba(56,189,248,.4),0 10px 25px rgba(15,23,42,.9);
  background:radial-gradient(circle at top,#0ea5e944,#020617);
}
.chip span.label{color:#e5e7eb;}
.chip span.value{font-weight:600;color:#7dd3fc;}
/* å‘½ä¸­ç´€éŒ„è¡¨ */
.hit-table-wrapper{
  max-height:260px;
  overflow:auto;
  border-radius:10px;
  border:1px solid rgba(148,163,184,.4);
  background:#020617;
}
.hit-table{
  width:100%;
  border-collapse:collapse;
  font-size:12px;
  min-width:480px;
}
.hit-table th,
.hit-table td{
  padding:6px 8px;
  border-bottom:1px solid rgba(30,64,175,.5);
}
.hit-table th{
  color:#bfdbfe;
  font-weight:600;
}
.hit-table tr:hover{
  background:#0b1120;
}
</style>
</head>
<body>

<h1>å°ç£ 539 ä¸­çæ©Ÿç‡è¨ˆç®—å™¨</h1>

<div id="stats" style="color:#60a5fa;font-size:13px;margin-bottom:8px"></div>

<div class="card">
  <label>è¡°æ¸›æ¬Šé‡ r</label>
  <div class="row">
    <input id="r" type="number" step="0.01" value="0.8" min="0" max="1" style="max-width:100px">
    <button class="btn sec" onclick="setR(0.6)">r=0.6</button>
    <button class="btn sec" onclick="setR(0.8)">r=0.8</button>
    <button class="btn sec" onclick="setR(0.95)">r=0.95</button>
  </div>

  <div class="row" style="margin-top:8px">
    <label class="switch"><input type="checkbox" id="streak" checked> ğŸ” ç†±è™Ÿé€£é–‹æ‡²ç½°</label>
    <label class="switch"><input type="checkbox" id="avoid" checked> é¿å…é‡è¤‡ä¸Šä¸€æœŸ</label>
  </div>

  <label style="margin-top:8px">æˆ‘çš„ä¸‹æ³¨ï¼ˆäº”é¡†ä¸€çµ„ï¼Œæ¯è¡Œä¸€çµ„ï¼‰</label>
  <textarea id="bets" placeholder="ä¾‹å¦‚ï¼š1 2 13 24 35"></textarea>

  <div class="row">
    <button class="btn" onclick="run()">è¨ˆç®—ä¸­çæ©Ÿç‡</button>
  </div>

  <div class="divider"></div>
  <label>æ–°å¢æœ€æ–°ä¸€æœŸï¼ˆäº”é¡†ï¼‰</label>
  <input id="latest" placeholder="ä¾‹å¦‚ï¼š3 11 22 27 38">
  <div class="row">
    <button class="btn" onclick="appendLatest()">ï¼‹ åŠ å…¥åˆ°æ­·å²</button>
    <button class="btn sec" onclick="clearAdded()">é‡ç½®æœ¬æ©Ÿæ–°å¢</button>
  </div>
</div>

<div class="card">
  <h3>ğŸ”¢ å„è™Ÿç¢¼æ©Ÿç‡åˆ†ä½ˆï¼ˆä¾æ¬Šé‡æ’åºï¼‰</h3>
  <div style="font-size:12px;color:#9ca3af">å–®è™Ÿå¹³å‡ç†è«–å€¼ï¼šç´„ 12.82%</div>
  <div id="singleTop" class="mono split2" style="margin-top:6px;">å°šæœªè¨ˆç®—</div>
</div>

<div class="card">
  <h3>ğŸ’¡ æ¨è–¦çµ„åˆ Top10</h3>
  <div style="font-size:12px;color:#9ca3af">ç†è«–æ©Ÿç‡ï¼š1 / C(39,5) â‰ˆ 0.0001737%</div>
  <div id="toplist" class="mono split2"></div>
</div>

<div class="card">
  <h3>æˆ‘çš„ä¸‹æ³¨çµæœ</h3>
  <div id="myres" class="mono" style="font-size:13px;color:#94a3b8">å°šæœªè¨ˆç®—</div>
</div>

<div class="card">
  <h3>ğŸ“ˆ å‘½ä¸­ç´€éŒ„è¡¨ï¼ˆTopN å›æ¸¬ï¼‰</h3>
  <div style="font-size:12px;color:#9ca3af">ä½¿ç”¨ Top5 å›æ¸¬</div>
  <div id="hitSummary" style="font-size:12px;color:#9ca3af;margin-bottom:4px">å°šæœªå›æ¸¬</div>
  <div class="hit-table-wrapper">
    <table class="hit-table" id="hitTable">
      <thead>
        <tr>
          <th>æœŸæ•¸</th><th>é–‹çè™Ÿç¢¼</th><th>æœ€ä½³å‘½ä¸­</th><th>å‘½ä¸­çµ„åˆ</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>
<script>
// --- å…§å»ºç¯„ä¾‹æ­·å²ï¼ˆæ¯æœŸ 5 é¡†ï¼‰ --- ğŸ”µ æ”¹ 539
const baseHistory = [
  [3,11,22,27,38],
  [5,9,12,19,33],
  [7,11,20,25,36],
  [2,4,17,28,31],
  [1,14,21,29,34]
];
const LS_KEY="extra539_v1";
let added = JSON.parse(localStorage.getItem(LS_KEY)||"[]");

function updateStats(){
  const total = baseHistory.length + added.length;
  const latest = (added.length? added[added.length-1]:baseHistory[baseHistory.length-1]).join(" ");
  stats.innerHTML = `ğŸ“Š å…± ${total} æœŸï¼Œæœ€æ–°ï¼š${latest}`;
}
updateStats();

function appendLatest(){
  const v = latest.value.trim().split(/\s+/).map(Number);
  if(v.length===5 && v.every(n=>n>=1 && n<=39)){
    added.push(v);
    localStorage.setItem(LS_KEY,JSON.stringify(added));
    latest.value="";
    updateStats();
  }else alert("è«‹è¼¸å…¥äº”å€‹ 1~39 çš„æ•¸å­—");
}
function clearAdded(){
  if(confirm("æ¸…é™¤æœ¬æ©Ÿæ–°å¢ï¼Ÿ")){
    added=[];
    localStorage.removeItem(LS_KEY);
    updateStats();
  }
}
function setR(v){document.getElementById("r").value=v;}
function getAll(){return baseHistory.concat(added);}

// --- å–®è™Ÿæ¬Šé‡ï¼ˆå« r + ç†±è™Ÿæ‡²ç½°ï¼‰ ğŸ”µ æ”¹ 39 é¡† ---
function singleProbsByR(hist,r,sp){
  const w = Array(39).fill(0);
  const n = hist.length;
  for(let i=0;i<n;i++){
    const ww=Math.pow(r,n-1-i);
    for(const x of hist[i]) w[x-1]+=ww;
  }

  // ç†±è™Ÿé€£é–‹æ‡²ç½° ğŸ”µ 539 èª¿æ•´
  if(sp){
    for(let num=1;num<=39;num++){
      let c=0, maxc=0;
      for(let i=0;i<n;i++){
        if(hist[i].includes(num)){c++;maxc=Math.max(maxc,c);}
        else c=0;
      }
      if(maxc>=3) w[num-1]*=0.75;
    }
  }

  const s = w.reduce((a,b)=>a+b,0)||1;
  return w.map(v=>v/s);
}
// --- ç”¢ç”Ÿæ‰€æœ‰ C(39,5) çµ„åˆï¼ˆå„ªåŒ–ç”Ÿæˆï¼‰ ---
function allCombos(){
  const r=[];
  for(let a=1;a<=35;a++)
    for(let b=a+1;b<=36;b++)
      for(let c=b+1;c<=37;c++)
        for(let d=c+1;d<=38;d++)
          for(let e=d+1;e<=39;e++)
            r.push([a,b,c,d,e]);
  return r;
}

// --- äº”é¡†çµ„åˆæ©Ÿç‡ï¼ˆä¹˜ç©æ¨¡å‹ï¼‰ ---
function comboProb(p,t){
  let s=1;
  for(let x of t) s*=p[x-1];
  return s;
}

// --- æ¨è–¦çµ„åˆè¨ˆç®—ï¼ˆå«ç†±è™Ÿ & é¿å…é‡è¤‡æ‡²ç½°ï¼‰ ---
function computeTopCombos(hist,probs,avoid){
  const last = hist[hist.length-1];
  const hotSet = new Set(last);
  const tri = allCombos();
  const scored=[];

  for(const t of tri){
    let sc = comboProb(probs,t);

    // ç†±è™Ÿæ‡²ç½° ğŸ”µ
    const hotCount = t.filter(x=>hotSet.has(x)).length;
    if(hotCount===1)sc*=0.95;
    else if(hotCount===2)sc*=0.90;
    else if(hotCount===3)sc*=0.80;
    else if(hotCount===4)sc*=0.65;
    else if(hotCount===5)sc*=0.55;

    // é¿å…é‡è¤‡ä¸Šä¸€æœŸ ğŸ”µ
    if(avoid){
      const dup = t.filter(x=>last.includes(x)).length;
      if(dup===1) sc*=0.90;
      else if(dup===2) sc*=0.70;
      else if(dup===3) sc*=0.45;
      else if(dup===4) sc*=0.25;
      else if(dup===5) sc*=0.10;
    }

    scored.push({t,sc});
  }

  scored.sort((a,b)=>b.sc-a.sc);
  return scored.slice(0,10);
}

// --- å–®è™Ÿæ’åºé¡¯ç¤º ---
function updateSingleTop(probs){
  const arr = probs.map((p,i)=>({num:i+1,p})).sort((a,b)=>b.p-a.p);
  const left = arr.slice(0,20);
  const right = arr.slice(20,39);
  singleTop.innerHTML = `
    <div>${left.map(o=>`<div class="chip"><span class="label">${o.num}</span><span class="value">${(o.p*100).toFixed(2)}%</span></div>`).join("")}</div>
    <div>${right.map(o=>`<div class="chip"><span class="label">${o.num}</span><span class="value">${(o.p*100).toFixed(2)}%</span></div>`).join("")}</div>
  `;
}

// --- å›æ¸¬ï¼ˆTop5ï¼‰ ---
function backtest(hist,r,sp,avoid){
  const rows=[];
  for(let i=1;i<hist.length-1;i++){
    const train=hist.slice(0,i+1);
    const target=hist[i+1];
    const probs=singleProbsByR(train,r,sp);
    const top=computeTopCombos(train,probs,avoid).slice(0,5);

    let bestHit=0;
    const hitList=[];
    for(const it of top){
      const hit=it.t.filter(x=>target.includes(x)).length;
      if(hit>0) hitList.push({t:it.t,hit});
      bestHit = Math.max(bestHit,hit);
    }

    rows.push({issue:i+1,target,bestHit,hitList});
  }
  return rows;
}

// --- å‘½ä¸­è¡¨æ¸²æŸ“ ---
function renderHits(rows){
  let html="", c1=0,c2=0,c3=0,c4=0,c5=0;
  for(const r of rows){
    if(r.bestHit===1)c1++;
    if(r.bestHit===2)c2++;
    if(r.bestHit===3)c3++;
    if(r.bestHit===4)c4++;
    if(r.bestHit===5)c5++;

    const comb = r.hitList.length? r.hitList.map(x=>x.t.join(" ")).join("ã€"):"â€”";
    html+=`
      <tr>
        <td>ç¬¬ ${r.issue} æœŸ</td>
        <td>${r.target.join(" ")}</td>
        <td>${r.bestHit} é¡†</td>
        <td>${comb}</td>
      </tr>`;
  }
  document.querySelector("#hitTable tbody").innerHTML=html;
  hitSummary.textContent = `è‡³å°‘ä¸­ 1 é¡†ï¼š${c1+c2+c3+c4+c5} æœŸ`;
}

// --- ä¸»ç¨‹å¼ ---
function run(){
  const hist=getAll();
  const r=parseFloat(document.getElementById("r").value)||0.8;
  const sp=document.getElementById("streak").checked;
  const avoid=document.getElementById("avoid").checked;

  const probs=singleProbsByR(hist,r,sp);
  updateSingleTop(probs);

  const top10 = computeTopCombos(hist,probs,avoid);
  toplist.innerHTML = `
    <div>${top10.slice(0,5).map((o,i)=>`<div class="chip rankTop">
      <span class="label">Top${i+1}ï½œ${o.t.join(" ")}</span>
      <span class="value">${(o.sc*100).toFixed(5)}%</span></div>`).join("")}</div>
    <div>${top10.slice(5,10).map((o,i)=>`<div class="chip">
      <span class="label">Top${i+6}ï½œ${o.t.join(" ")}</span>
      <span class="value">${(o.sc*100).toFixed(5)}%</span></div>`).join("")}</div>
  `;

  // æˆ‘çš„ä¸‹æ³¨
  const bets=document.getElementById("bets").value.trim();
  if(!bets){ myres.textContent="å°šæœªè¼¸å…¥ä¸‹æ³¨"; return; }
  const lines=bets.split(/\n+/);
  const out=[];
  for(const l of lines){
    const t=l.trim().split(/\s+/).map(Number);
    if(t.length!==5){ out.push(`${l} â†’ æ ¼å¼éŒ¯èª¤`); continue; }
    const p=comboProb(probs,t);
    out.push(`${l} â†’ ${(p*100).toFixed(6)}%`);
  }
  myres.textContent=out.join("\n");

  const rows=backtest(hist,r,sp,avoid);
  renderHits(rows);
}
</script>
</body>
</html>
