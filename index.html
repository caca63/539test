<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>å°ç£ 539 AI æ©Ÿç‡åˆ†æå™¨ v3</title>

<!-- ECharts -->
<script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>

<!-- TensorFlow.js -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.18.0/dist/tf.min.js"></script>

<style>
body{
  background:#0f172a;
  color:#e5e7eb;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial;
  margin:0;
  padding:16px;
}
.card{
  background:#111827cc;
  padding:14px;
  border-radius:16px;
  margin-bottom:12px;
  box-shadow:0 10px 25px rgba(15,23,42,.6);
}
.btn{
  padding:8px 12px;
  border-radius:999px;
  border:0;
  background:linear-gradient(135deg,#22d3ee,#60a5fa);
  color:#020617;
  font-weight:700;
  cursor:pointer;
}
.btn.sec{
  background:#020617;
  color:#e5e7eb;
  border:1px solid rgba(148,163,184,.25);
}
input,textarea,select{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid rgba(148,163,184,.25);
  background:#020617;
  color:#e5e7eb;
}
.row{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  align-items:center;
}
.split2{
  display:flex;
  gap:10px;
}
.split2>div{flex:1;}

.chip{
  background:#1e293b;
  border-radius:12px;
  padding:6px 8px;
  font-size:13px;
  border:1px solid rgba(148,163,184,.35);
  display:flex;
  justify-content:space-between;
  margin:4px 0;
}
.chip.rankTop{
  border-color:#38bdf8;
  background:radial-gradient(circle at top,#0ea5e944,#020617);
}
.chartBox{
  width:100%;
  height:320px;
  background:#0b1120;
  border-radius:12px;
  margin-top:10px;
}
</style>
</head>

<body>

<h1>å°ç£ 539 AI æ©Ÿç‡åˆ†æå™¨ v3</h1>

<div id="stats" style="margin-bottom:8px;color:#60a5fa"></div>

<!-- r è¡°æ¸› + è¨­å®š -->
<div class="card">
  <label>è¡°æ¸›æ¬Šé‡ r</label>
  <div class="row">
    <input id="r" type="number" step="0.01" min="0" max="1" value="0.8" style="max-width:100px">
    <button class="btn sec" onclick="setR(0.6)">r=0.6</button>
    <button class="btn sec" onclick="setR(0.8)">r=0.8</button>
    <button class="btn sec" onclick="setR(0.95)">r=0.95</button>
  </div>

  <div class="row">
    <label><input type="checkbox" id="streak" checked> ğŸ” ç†±è™Ÿé€£é–‹æ‡²ç½°</label>
    <label><input type="checkbox" id="avoid" checked> é¿å…é‡è¤‡ä¸Šä¸€æœŸ</label>
    <label><input type="checkbox" id="useAI" checked> ğŸ¤– ä½¿ç”¨ AIï¼ˆMarkov + TensorFlowï¼‰</label>
  </div>
</div>

<!-- æ–°å¢æœŸæ•¸ -->
<div class="card">
  <label>æ–°å¢æœ€æ–°ä¸€æœŸï¼ˆäº”é¡†ï¼‰</label>
  <input id="latest" placeholder="ä¾‹å¦‚ï¼š3 11 22 27 38">
  <div class="row">
    <button class="btn" onclick="appendLatest()">åŠ å…¥åˆ°æ­·å²</button>
    <button class="btn sec" onclick="clearAdded()">é‡ç½®æœ¬æ©Ÿæ–°å¢</button>
  </div>
</div>

<!-- å–®è™Ÿ AI æ©Ÿç‡ï¼ˆæ’åºï¼‰ -->
<div class="card">
  <h3>ğŸ”¢ å–®è™Ÿ AI æ©Ÿç‡ï¼ˆä¾æ¬Šé‡æ’åºï¼‰</h3>
  <div id="singleTop" class="split2" style="margin-top:6px;font-size:13px;color:#9ca3af">
    å°šæœªè¨ˆç®—
  </div>
</div>

<!-- Top10 -->
<div class="card">
  <h3>ğŸ’¡ æ¨è–¦çµ„åˆ Top10ï¼ˆAI + WebWorkerï¼‰</h3>
  <div id="toplist" class="split2"></div>

  <div class="row" style="margin-top:10px">
    <button class="btn" onclick="run()">ğŸ”¥ è¨ˆç®— AI é æ¸¬</button>
  </div>
</div>

<div class="card">
  <h3>ğŸ¤– ç”¢ç”Ÿ AI æ¨¡å‹ï¼ˆmodel.json + weights.binï¼‰</h3>
  <button class="btn" onclick="generateModelFiles()">
    ç”¢ç”Ÿ AI æ¨¡å‹ï¼ˆGlorot åˆå§‹åŒ–ï¼‰
  </button>
  <div style="font-size:12px;color:#94a3b8;margin-top:6px;">
    æŒ‰ä¸‹å¾Œï¼Œç€è¦½å™¨æœƒè‡ªå‹•ä¸‹è¼‰ model.json èˆ‡ weights.binã€‚
  </div>
</div>

<!-- æˆ‘çš„ä¸‹æ³¨ -->
<div class="card">
  <h3>æˆ‘çš„ä¸‹æ³¨çµæœ</h3>
  <textarea id="bets" placeholder="ä¾‹å¦‚ï¼š1 12 23 28 35"></textarea>
  <div id="myres" style="white-space:pre-wrap;margin-top:10px;color:#94a3b8">å°šæœªè¨ˆç®—</div>
</div>

<!-- åœ–è¡¨ -->
<div class="card">
  <h3>ğŸ“ˆ é€£èŠèµ°å‹¢åœ–ï¼ˆèˆ‡å‰ä¸€æœŸé‡è¤‡çš„è™Ÿç¢¼æ•¸ï¼‰</h3>
  <canvas id="streakChart" height="180"></canvas>
</div>

<div class="card">
  <h3>ğŸ“Š å„è™Ÿç¢¼å‡ºç¾æ¬¡æ•¸çµ±è¨ˆï¼ˆ1~39ï¼‰</h3>
  <canvas id="countChart" height="220"></canvas>
</div>

<!-- å›æ¸¬ -->
<div class="card">
  <h3>ğŸ“ˆ å›æ¸¬ï¼ˆTop5ï¼‰</h3>
  <div id="hitSummary" style="margin-bottom:8px;color:#94a3b8">å°šæœªå›æ¸¬</div>
  <table style="width:100%;font-size:12px;border-collapse:collapse;">
    <thead>
      <tr style="color:#bfdbfe">
        <th>æœŸæ•¸</th><th>é–‹ç</th><th>æœ€ä½³</th><th>å‘½ä¸­çµ„åˆ</th>
      </tr>
    </thead>
    <tbody id="hitTable"></tbody>
  </table>
</div>

<script src="issueDate.js"></script>
<script src="fetchData.js"></script>
<script src="charts.js"></script>
<script src="ai.js"></script>

<script>
// ------------------ Data ----------------------
const LS_KEY = "extra539_v3";
let added = JSON.parse(localStorage.getItem(LS_KEY) || "[]");

// âœ… é€™è£¡è²¼ã€Œä½ å‰›å‰›é‚£ä¸€å¤§ä¸²ã€å¾ 11/14 åˆ° 01/01 çš„åŸå§‹æ–‡å­—ï¼ˆä¸ç”¨æ”¹æ ¼å¼ï¼‰
const RAW_HISTORY = `
11/14
25(äº”)	02, 11, 15, 37, 38
11/13
25(å››)	13, 18, 20, 23, 36
11/12
25(ä¸‰)	01, 04, 09, 14, 22
11/11
25(äºŒ)	05, 19, 31, 34, 39
11/10
25(ä¸€)	07, 14, 15, 17, 30
11/08
25(å…­)	07, 08, 09, 26, 34
11/07
25(äº”)	22, 27, 30, 32, 37
11/06
25(å››)	07, 24, 28, 31, 32
11/05
25(ä¸‰)	11, 14, 15, 27, 39
11/04
25(äºŒ)	01, 07, 12, 29, 39
11/03
25(ä¸€)	24, 25, 34, 36, 37
11/01
25(å…­)	08, 12, 19, 27, 28
10/31
25(äº”)	11, 18, 25, 26, 33
10/30
25(å››)	05, 27, 28, 31, 37
10/29
25(ä¸‰)	26, 32, 33, 36, 39
10/28
25(äºŒ)	18, 20, 25, 29, 31
10/27
25(ä¸€)	03, 20, 26, 31, 37
10/25
25(å…­)	03, 04, 11, 21, 34
10/24
25(äº”)	08, 11, 13, 37, 38
10/23
25(å››)	08, 15, 27, 37, 38
10/22
25(ä¸‰)	03, 04, 20, 25, 28
10/21
25(äºŒ)	13, 22, 30, 37, 38
10/20
25(ä¸€)	06, 13, 22, 23, 27
10/18
25(å…­)	02, 17, 32, 35, 38
10/17
25(äº”)	01, 21, 31, 32, 34
10/16
25(å››)	04, 18, 21, 30, 37
10/15
25(ä¸‰)	04, 07, 19, 33, 39
10/14
25(äºŒ)	04, 05, 09, 18, 24
10/13
25(ä¸€)	08, 13, 14, 22, 36
10/11
25(å…­)	04, 09, 19, 22, 34
10/10
25(äº”)	03, 06, 24, 31, 36
10/09
25(å››)	02, 04, 12, 15, 29
10/08
25(ä¸‰)	03, 09, 26, 38, 39
10/07
25(äºŒ)	01, 16, 20, 28, 34
10/06
25(ä¸€)	03, 05, 06, 12, 13
10/04
25(å…­)	03, 04, 10, 18, 39
10/03
25(äº”)	10, 16, 19, 21, 28
10/02
25(å››)	10, 19, 25, 36, 39
10/01
25(ä¸‰)	03, 05, 12, 22, 27
09/30
25(äºŒ)	14, 20, 21, 28, 33
09/29
25(ä¸€)	03, 15, 21, 29, 37
09/27
25(å…­)	03, 11, 13, 28, 37
09/26
25(äº”)	03, 07, 14, 25, 34
09/25
25(å››)	02, 10, 13, 28, 32
09/24
25(ä¸‰)	04, 22, 23, 35, 39
09/23
25(äºŒ)	06, 19, 20, 33, 37
09/22
25(ä¸€)	07, 09, 12, 14, 33
09/20
25(å…­)	05, 08, 11, 13, 22
09/19
25(äº”)	02, 11, 22, 24, 31
09/18
25(å››)	05, 12, 14, 23, 33
09/17
25(ä¸‰)	04, 06, 07, 12, 38
09/16
25(äºŒ)	02, 09, 19, 21, 33
09/15
25(ä¸€)	07, 09, 10, 12, 28
09/13
25(å…­)	02, 25, 32, 35, 36
09/12
25(äº”)	09, 12, 16, 26, 34
09/11
25(å››)	06, 18, 26, 28, 36
09/10
25(ä¸‰)	12, 14, 16, 28, 39
09/09
25(äºŒ)	08, 20, 23, 25, 26
09/08
25(ä¸€)	07, 11, 20, 28, 38
09/06
25(å…­)	08, 14, 25, 28, 31
09/05
25(äº”)	07, 09, 29, 32, 38
09/04
25(å››)	06, 07, 24, 27, 34
09/03
25(ä¸‰)	14, 15, 20, 21, 23
09/02
25(äºŒ)	05, 08, 10, 23, 25
09/01
25(ä¸€)	21, 24, 28, 29, 35
08/30
25(å…­)	04, 05, 07, 13, 14
08/29
25(äº”)	07, 20, 21, 30, 38
08/28
25(å››)	05, 07, 21, 23, 29
08/27
25(ä¸‰)	03, 05, 28, 30, 32
08/26
25(äºŒ)	02, 05, 24, 38, 39
08/25
25(ä¸€)	06, 12, 15, 23, 26
08/23
25(å…­)	04, 05, 08, 27, 39
08/22
25(äº”)	06, 07, 21, 37, 38
08/21
25(å››)	16, 27, 28, 29, 33
08/20
25(ä¸‰)	15, 18, 29, 31, 39
08/19
25(äºŒ)	06, 07, 18, 31, 35
08/18
25(ä¸€)	09, 12, 18, 27, 29
08/16
25(å…­)	15, 18, 22, 24, 31
08/15
25(äº”)	01, 05, 16, 18, 26
08/14
25(å››)	10, 12, 14, 31, 35
08/13
25(ä¸‰)	11, 23, 26, 32, 34
08/12
25(äºŒ)	01, 09, 17, 25, 30
08/11
25(ä¸€)	01, 14, 22, 26, 28
08/09
25(å…­)	01, 09, 27, 29, 30
08/08
25(äº”)	11, 25, 27, 30, 34
08/07
25(å››)	10, 20, 28, 30, 37
08/06
25(ä¸‰)	06, 10, 24, 28, 38
08/05
25(äºŒ)	13, 20, 21, 32, 37
08/04
25(ä¸€)	03, 21, 23, 25, 26
08/02
25(å…­)	03, 14, 22, 25, 31
08/01
25(äº”)	02, 13, 18, 33, 34
07/31
25(å››)	11, 12, 17, 34, 36
07/30
25(ä¸‰)	17, 22, 24, 30, 32
07/29
25(äºŒ)	01, 06, 10, 13, 27
07/28
25(ä¸€)	04, 16, 22, 23, 30
07/26
25(å…­)	14, 15, 18, 23, 29
07/25
25(äº”)	05, 07, 10, 26, 30
07/24
25(å››)	02, 06, 09, 29, 32
07/23
25(ä¸‰)	16, 18, 23, 36, 39
07/22
25(äºŒ)	19, 21, 27, 32, 39
07/21
25(ä¸€)	01, 06, 11, 22, 34
07/19
25(å…­)	07, 11, 14, 26, 27
07/18
25(äº”)	12, 21, 22, 38, 39
07/17
25(å››)	04, 06, 11, 29, 37
07/16
25(ä¸‰)	15, 18, 24, 31, 32
07/15
25(äºŒ)	09, 16, 21, 22, 38
07/14
25(ä¸€)	08, 11, 12, 29, 36
07/12
25(å…­)	03, 19, 20, 21, 26
07/11
25(äº”)	09, 26, 37, 38, 39
07/10
25(å››)	02, 03, 04, 34, 36
07/09
25(ä¸‰)	13, 18, 27, 28, 37
07/08
25(äºŒ)	03, 04, 24, 27, 33
07/07
25(ä¸€)	14, 25, 27, 35, 38
07/05
25(å…­)	08, 14, 22, 24, 35
07/04
25(äº”)	05, 24, 31, 36, 39
07/03
25(å››)	10, 21, 22, 26, 27
07/02
25(ä¸‰)	06, 13, 21, 24, 38
07/01
25(äºŒ)	06, 08, 11, 19, 38
06/30
25(ä¸€)	07, 08, 11, 23, 31
06/28
25(å…­)	12, 22, 29, 33, 34
06/27
25(äº”)	03, 04, 10, 19, 37
06/26
25(å››)	01, 06, 13, 24, 29
06/25
25(ä¸‰)	02, 11, 28, 30, 37
06/24
25(äºŒ)	01, 10, 12, 20, 31
06/23
25(ä¸€)	03, 14, 22, 31, 38
06/21
25(å…­)	03, 08, 15, 24, 39
06/20
25(äº”)	02, 05, 08, 17, 24
06/19
25(å››)	12, 14, 15, 17, 24
06/18
25(ä¸‰)	07, 12, 23, 26, 36
06/17
25(äºŒ)	02, 12, 14, 26, 37
06/16
25(ä¸€)	06, 08, 09, 33, 36
06/14
25(å…­)	02, 15, 17, 23, 37
06/13
25(äº”)	04, 05, 10, 12, 38
06/12
25(å››)	11, 14, 15, 19, 32
06/11
25(ä¸‰)	04, 17, 19, 21, 31
06/10
25(äºŒ)	07, 12, 16, 29, 38
06/09
25(ä¸€)	08, 20, 27, 29, 30
06/07
25(å…­)	04, 16, 22, 23, 32
06/06
25(äº”)	02, 12, 14, 25, 30
06/05
25(å››)	07, 14, 19, 35, 39
06/04
25(ä¸‰)	20, 30, 33, 36, 38
06/03
25(äºŒ)	07, 20, 21, 25, 34
06/02
25(ä¸€)	02, 07, 11, 16, 21
05/31
25(å…­)	14, 18, 20, 29, 35
05/30
25(äº”)	14, 20, 21, 34, 35
05/29
25(å››)	04, 18, 28, 30, 31
05/28
25(ä¸‰)	09, 13, 15, 24, 33
05/27
25(äºŒ)	04, 08, 23, 33, 38
05/26
25(ä¸€)	08, 15, 21, 24, 34
05/24
25(å…­)	14, 18, 29, 35, 36
05/23
25(äº”)	13, 16, 24, 27, 32
05/22
25(å››)	01, 08, 17, 21, 35
05/21
25(ä¸‰)	10, 16, 31, 34, 38
05/20
25(äºŒ)	10, 22, 23, 26, 38
05/19
25(ä¸€)	04, 07, 14, 25, 35
05/17
25(å…­)	03, 09, 24, 30, 39
05/16
25(äº”)	02, 13, 24, 27, 39
05/15
25(å››)	02, 04, 15, 25, 36
05/14
25(ä¸‰)	01, 14, 18, 24, 38
05/13
25(äºŒ)	04, 10, 20, 23, 29
05/12
25(ä¸€)	08, 10, 26, 27, 38
05/10
25(å…­)	06, 09, 20, 27, 36
05/09
25(äº”)	04, 11, 19, 21, 34
05/08
25(å››)	07, 10, 26, 28, 33
05/07
25(ä¸‰)	07, 09, 21, 28, 38
05/06
25(äºŒ)	06, 11, 18, 37, 39
05/05
25(ä¸€)	04, 05, 08, 10, 11
05/03
25(å…­)	01, 10, 19, 27, 31
05/02
25(äº”)	05, 12, 20, 24, 28
05/01
25(å››)	08, 19, 25, 27, 39
04/30
25(ä¸‰)	22, 26, 30, 31, 38
04/29
25(äºŒ)	01, 07, 13, 18, 35
04/28
25(ä¸€)	06, 12, 17, 38, 39
04/26
25(å…­)	20, 23, 32, 35, 38
04/25
25(äº”)	01, 05, 24, 33, 36
04/24
25(å››)	04, 06, 25, 29, 35
04/23
25(ä¸‰)	01, 16, 19, 27, 33
04/22
25(äºŒ)	08, 19, 23, 27, 31
04/21
25(ä¸€)	02, 06, 12, 14, 24
04/19
25(å…­)	14, 19, 21, 26, 36
04/18
25(äº”)	07, 24, 28, 31, 36
04/17
25(å››)	03, 06, 23, 24, 37
04/16
25(ä¸‰)	07, 22, 25, 29, 38
04/15
25(äºŒ)	02, 03, 16, 27, 39
04/14
25(ä¸€)	09, 10, 22, 30, 33
04/12
25(å…­)	09, 11, 15, 25, 31
04/11
25(äº”)	15, 17, 26, 27, 35
04/10
25(å››)	14, 19, 22, 26, 28
04/09
25(ä¸‰)	04, 06, 14, 24, 35
04/08
25(äºŒ)	06, 17, 18, 19, 32
04/07
25(ä¸€)	01, 06, 19, 26, 33
04/05
25(å…­)	12, 13, 14, 15, 24
04/04
25(äº”)	03, 06, 07, 36, 38
04/03
25(å››)	05, 16, 23, 31, 39
04/02
25(ä¸‰)	04, 08, 29, 32, 34
04/01
25(äºŒ)	05, 13, 17, 19, 31
03/31
25(ä¸€)	07, 10, 13, 23, 26
03/29
25(å…­)	04, 09, 12, 17, 27
03/28
25(äº”)	13, 24, 25, 36, 39
03/27
25(å››)	05, 25, 33, 36, 37
03/26
25(ä¸‰)	01, 10, 12, 32, 35
03/25
25(äºŒ)	04, 20, 24, 27, 38
03/24
25(ä¸€)	07, 25, 32, 34, 35
03/22
25(å…­)	05, 13, 16, 24, 28
03/21
25(äº”)	05, 09, 15, 20, 26
03/20
25(å››)	02, 16, 17, 27, 32
03/19
25(ä¸‰)	11, 15, 25, 29, 34
03/18
25(äºŒ)	03, 13, 15, 19, 25
03/17
25(ä¸€)	07, 11, 13, 26, 30
03/15
25(å…­)	08, 15, 25, 26, 34
03/14
25(äº”)	06, 08, 18, 19, 28
03/13
25(å››)	03, 04, 07, 11, 30
03/12
25(ä¸‰)	06, 14, 27, 30, 33
03/11
25(äºŒ)	02, 21, 24, 27, 31
03/10
25(ä¸€)	02, 04, 07, 25, 37
03/08
25(å…­)	17, 23, 24, 27, 35
03/07
25(äº”)	09, 10, 19, 33, 35
03/06
25(å››)	08, 12, 15, 18, 34
03/05
25(ä¸‰)	15, 23, 29, 36, 39
03/04
25(äºŒ)	11, 18, 21, 23, 36
03/03
25(ä¸€)	08, 09, 12, 22, 27
03/01
25(å…­)	04, 16, 29, 31, 34
02/28
25(äº”)	05, 27, 31, 38, 39
02/27
25(å››)	11, 12, 20, 28, 29
02/26
25(ä¸‰)	03, 11, 24, 27, 36
02/25
25(äºŒ)	05, 11, 26, 33, 35
02/24
25(ä¸€)	08, 17, 18, 24, 36
02/22
25(å…­)	04, 07, 11, 19, 22
02/21
25(äº”)	11, 13, 18, 30, 35
02/20
25(å››)	03, 07, 17, 24, 27
02/19
25(ä¸‰)	03, 27, 28, 33, 38
02/18
25(äºŒ)	10, 12, 13, 19, 33
02/17
25(ä¸€)	09, 15, 29, 30, 39
02/15
25(å…­)	06, 08, 10, 21, 26
02/14
25(äº”)	11, 17, 29, 34, 39
02/13
25(å››)	02, 07, 11, 20, 30
02/12
25(ä¸‰)	02, 06, 19, 28, 29
02/11
25(äºŒ)	10, 18, 19, 27, 28
02/10
25(ä¸€)	12, 22, 26, 28, 35
02/09
25(æ—¥)	04, 05, 27, 35, 37
02/08
25(å…­)	08, 24, 28, 37, 38
02/07
25(äº”)	16, 21, 26, 29, 37
02/06
25(å››)	03, 07, 22, 29, 34
02/05
25(ä¸‰)	06, 07, 08, 14, 39
02/04
25(äºŒ)	01, 08, 16, 19, 31
02/03
25(ä¸€)	04, 16, 21, 23, 37
02/02
25(æ—¥)	09, 16, 29, 32, 39
02/01
25(å…­)	01, 10, 23, 32, 37
01/31
25(äº”)	01, 05, 09, 14, 26
01/30
25(å››)	09, 11, 14, 18, 27
01/29
25(ä¸‰)	04, 11, 25, 31, 32
01/28
25(äºŒ)	13, 22, 23, 24, 35
01/27
25(ä¸€)	01, 06, 16, 26, 31
01/26
25(æ—¥)	07, 08, 09, 17, 20
01/25
25(å…­)	01, 07, 32, 36, 37
01/24
25(äº”)	05, 09, 12, 14, 31
01/23
25(å››)	04, 07, 17, 22, 35
01/22
25(ä¸‰)	06, 19, 23, 26, 30
01/21
25(äºŒ)	01, 14, 18, 19, 22
01/20
25(ä¸€)	03, 12, 19, 32, 34
01/18
25(å…­)	07, 12, 18, 35, 39
01/17
25(äº”)	04, 07, 08, 24, 26
01/16
25(å››)	09, 13, 23, 29, 34
01/15
25(ä¸‰)	03, 21, 22, 26, 39
01/14
25(äºŒ)	10, 22, 31, 35, 36
01/13
25(ä¸€)	04, 12, 28, 35, 38
01/11
25(å…­)	05, 12, 13, 19, 34
01/10
25(äº”)	09, 11, 15, 18, 20
01/09
25(å››)	02, 08, 19, 21, 29
01/08
25(ä¸‰)	12, 18, 20, 24, 31
01/07
25(äºŒ)	13, 23, 27, 31, 37
01/06
25(ä¸€)	07, 21, 22, 27, 35
01/04
25(å…­)	08, 09, 12, 21, 23
01/03
25(äº”)	05, 06, 08, 11, 14
01/02
25(å››)	12, 26, 30, 32, 33
01/01
25(ä¸‰)	02, 07, 08, 10, 14
`;

// æŠŠä¸Šé¢çš„ RAW_HISTORY è§£ææˆ [[2,11,15,37,38], ...] é€™ç¨®æ ¼å¼
function parseRawHistory(raw) {
  const hist = [];
  raw.split(/\n/).forEach(line => {
    const m = line.match(/(\d+),\s*(\d+),\s*(\d+),\s*(\d+),\s*(\d+)/);
    if (m) {
      hist.push(m.slice(1).map(Number)); // åªå– 5 å€‹è™Ÿç¢¼
    }
  });
  // ä½ çš„åŸå§‹æ–‡å­—æ˜¯ã€Œæœ€æ–°åœ¨æœ€ä¸Šé¢ã€ï¼Œç¨‹å¼æ…£ä¾‹æ˜¯ã€Œæœ€èˆŠåœ¨å‰ã€æœ€æ–°åœ¨æœ€å¾Œã€
  // æ‰€ä»¥é€™è£¡åè½‰ä¸€ä¸‹ï¼Œè®“ baseHistory[baseHistory.length-1] = æœ€æ–°ä¸€æœŸ
  return hist.reverse();
}

// âœ… çœŸæ­£çµ¦ç³»çµ±ç”¨çš„æ­·å²é™£åˆ—
let baseHistory = parseRawHistory(RAW_HISTORY);

function getAll() {
  return baseHistory.concat(added);
}

function updateStats() {
  const all = getAll();
  const latest = all[all.length - 1] || [];
  document.getElementById("stats").innerHTML =
    `ğŸ“Š æ­·å²æœŸæ•¸ï¼š${all.length}ã€€æœ€æ–°ï¼š${latest.join(" ")}`;
}
updateStats();

function appendLatest() {
  const v = latest.value.trim().split(/\s+/).map(Number);
  if (v.length === 5 && v.every(n => n >= 1 && n <= 39)) {
    added.push(v);
    localStorage.setItem(LS_KEY, JSON.stringify(added));
    updateStats();
    latest.value = "";
  } else alert("äº”é¡† 1~39");
}

function clearAdded() {
  if (confirm("æ¸…é™¤æœ¬æ©Ÿæ–°å¢ï¼Ÿ")) {
    added = [];
    localStorage.removeItem(LS_KEY);
    updateStats();
  }
}

function setR(v) { document.getElementById("r").value = v; }

// ------------------ WebWorker ----------------------
const worker=new Worker("worker.js");
let workerReady=false;

worker.onmessage=function(e){
  const msg=e.data;

  if(msg.type==="ready"){
    workerReady=true;
    return;
  }
  if(msg.type==="top10"){
    renderTop10(msg.data);
    return;
  }
};

function computeTop10(probs,last,avoid,streak){
  if(!workerReady){
    alert("Worker å°šæœªè¼‰å…¥å®Œç•¢ï¼");
    return;
  }
  worker.postMessage({
    type:"computeTop10",
    probs,last,avoid,streak
  });
}


// ------------------ å–®è™Ÿæ’åº ----------------------
function updateSingleTop(probs){
  const arr=probs.map((p,i)=>({num:i+1,p})).sort((a,b)=>b.p-a.p);

  const left=arr.slice(0,20);
  const right=arr.slice(20);

  singleTop.innerHTML=`
    <div>${left.map(o=>`<div class="chip"><span>${o.num}</span><span>${(o.p*100).toFixed(3)}%</span></div>`).join("")}</div>
    <div>${right.map(o=>`<div class="chip"><span>${o.num}</span><span>${(o.p*100).toFixed(3)}%</span></div>`).join("")}</div>
  `;
}


// ------------------ Top10 ----------------------
function renderTop10(list){
  const left=list.slice(0,5);
  const right=list.slice(5);

  toplist.innerHTML=`
    <div>${left.map((o,i)=>`
      <div class="chip rankTop">
        <span>Top${i+1}ï½œ${o.t.join(" ")}</span>
        <span>${(o.score*100).toFixed(6)}%</span>
      </div>`).join("")}</div>

    <div>${right.map((o,i)=>`
      <div class="chip">
        <span>Top${i+6}ï½œ${o.t.join(" ")}</span>
        <span>${(o.score*100).toFixed(6)}%</span>
      </div>`).join("")}</div>
  `;
}


// ------------------ å›æ¸¬ï¼ˆä¿®æ­£ç‰ˆï¼‰ ----------------------
async function backtest(all){
  const rows=[];
  const streak = document.getElementById("streak").checked;
  const avoid = document.getElementById("avoid").checked;

  for(let i=1;i<all.length-1;i++){
    const train = all.slice(0,i+1);
    const target = all[i+1];

    // ğŸ”¥ğŸ”¥ é—œéµä¿®æ­£ï¼šè¦ await æ‰èƒ½å¾—åˆ° 39 å€‹æ©Ÿç‡
    const probs = await window.AI_finalProb(train);

    const last = train[train.length-1];

    // Top5ï¼ˆæœ¬åœ°é‹ç®—ç‰ˆï¼‰
    const top5 = window.AI_localComputeTop5(probs,last,avoid,streak);

    let best = 0;
    const hitList = [];
    for(const t of top5){
      const hit = t.t.filter(x=>target.includes(x)).length;
      if(hit>0) hitList.push({t:t.t, hit});
      best = Math.max(best, hit);
    }

    rows.push({issue:i+1, target, best, hitList});
  }
  return rows;
}

function renderHits(rows){
  let html="";
  let c1=0,c2=0,c3=0,c4=0,c5=0;

  for(const r of rows){
    if(r.best===1)c1++;
    if(r.best===2)c2++;
    if(r.best===3)c3++;
    if(r.best===4)c4++;
    if(r.best===5)c5++;

    html+=`
      <tr>
        <td>${r.issue}</td>
        <td>${r.target.join(" ")}</td>
        <td>${r.best}</td>
        <td>${r.hitList.map(x=>`${x.t.join(" ")}(${x.hit})`).join("ã€") || "-"}</td>
      </tr>`;
  }
  hitTable.innerHTML=html;

  hitSummary.innerHTML=
    `è‡³å°‘ä¸­ 1 é¡†ï¼š${c1+c2+c3+c4+c5} æœŸï¼ˆå«å…¨ä¸­ ${c5} æœŸï¼‰`;
}


// ------------------ ä¸»æµç¨‹ ----------------------
async function run(){
  const all=getAll();

  // 1. è¨ˆç®—å–®è™Ÿ AI æ©Ÿç‡
  const probs=await AI_finalProb(all);
  updateSingleTop(probs);

  // 2. Worker è¨ˆç®— Top10
  computeTop10(
    probs,
    all[all.length-1],
    document.getElementById("avoid").checked,
    document.getElementById("streak").checked
  );

  // 3. æˆ‘çš„ä¸‹æ³¨
  const betLines=bets.value.trim().split(/\n+/);
  const out=[];
  for(const line of betLines){
    const t=line.split(/\s+/).map(Number);
    if(t.length!==5){out.push(`${line} â†’ æ ¼å¼éŒ¯èª¤`);continue;}
    let s=1; t.forEach(n=>s*=probs[n-1]);
    out.push(`${line} â†’ ${(s*100).toFixed(6)}%`);
  }
  myres.textContent=out.join("\n");

  // 4. å›æ¸¬
  const rows=backtest(all);
  renderHits(rows);

  // 5. æ›´æ–°åœ–è¡¨
  drawStreakChart(all);
  drawCountChart(all);
}

async function generateModelFiles() {
  // å»ºæ§‹ C å‹æ¨¡å‹
  const model = tf.sequential();
  model.add(tf.layers.dense({ units: 512, activation: "relu", inputShape: [39 * 20] }));
  model.add(tf.layers.dense({ units: 256, activation: "relu" }));
  model.add(tf.layers.dense({ units: 128, activation: "relu" }));
  model.add(tf.layers.dense({ units: 64,  activation: "relu" }));
  model.add(tf.layers.dense({ units: 39,  activation: "softmax" }));

  model.compile({
    optimizer: tf.train.adam(0.001),
    loss: "categoricalCrossentropy"
  });

  // è®“æ¬Šé‡åˆå§‹åŒ–ï¼ˆé‡é»ï¼ï¼‰
  // å»ºä¸€å€‹å‡çš„è¼¸å…¥ä¸Ÿé€²å»ä¸€æ¬¡
  const dummy = tf.zeros([1, 39 * 20]);
  model.predict(dummy);

  // å­˜åˆ°æœ¬æ©Ÿ â†’ æœƒè‡ªå‹•ä¸‹è¼‰ model.json + weights.bin
  await model.save("downloads://539-ai-model");

  alert("ğŸ‰ AI æ¨¡å‹å·²ç”¢ç”Ÿï¼è«‹æŸ¥çœ‹ä¸‹è¼‰çš„ model.json èˆ‡ weights.bin");
}
</script>
</body>
</html>
